<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<DeployProcessRequest service="WPS" version="1.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:wps="http://www.opengis.net/wps/1.0.0" xmlns:ows="http://www.opengis.net/ows/1.1" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://www.opengis.net/wps/1.0.0 wpsDeployProcess_request4.xsd">
	<wps:ProcessDescriptions xmlns:ows="http://www.opengis.net/ows/1.1" xml:lang="en-US" service="WPS" version="1.0.0">
		<ProcessDescription wps:processVersion="2" storeSupported="true" statusSupported="false">
			<ows:Identifier>wpsHelloWorld</ows:Identifier>
			<ows:Title>wpsHelloWorld</ows:Title>
			<ows:Abstract>wpsHelloWorld</ows:Abstract>
			<DataInputs>
				<Input minOccurs="1" maxOccurs="1">
					<ows:Identifier>name</ows:Identifier>
					<ows:Title>name</ows:Title>
					<ows:Abstract/>
					<LiteralData>
						<ows:DataType ows:reference="xs:string"/>
						<ows:AllowedValues>
							<ows:Value/>
						</ows:AllowedValues>
					</LiteralData>
				</Input>
			</DataInputs>
			<ProcessOutputs>
				<Output>
					<ows:Identifier>result</ows:Identifier>
					<ows:Title>result</ows:Title>
					<ows:Abstract/>
					<LiteralOutput>
						<ows:DataType ows:reference="xs:string"/>
					</LiteralOutput>
				</Output>
			</ProcessOutputs>
		</ProcessDescription>
	</wps:ProcessDescriptions>
	<wps:DeploymentProfile>
		<wps:Schema href="BPELProfile.xsd"/>
		<SuitCase>
			<BPELSuitcase revision="1.0" timestamp="1213047485681">
				<deploy xmlns="http://www.apache.org/ode/schemas/dd/2007/03" xmlns:wps_1.0.0="http://www.opengis.net/wps/1.0.0" xmlns:www.uncertweb.org="http://www.uncertweb.org">
					<process name="www.uncertweb.org:Austal">
						<active>true</active>
						<retired>false</retired>
						<process-events generate="none"/>
						<provide partnerLink="client">
							<service name="www.uncertweb.org:Austal" port="AustalPort"/>
						</provide>
						<invoke partnerLink="generalizewps">
							<service name="wps_1.0.0:GeneralizeWPS" port="GeneralizeWPSPort"/>
						</invoke>
						<invoke partnerLink="austalwps">
							<service name="wps_1.0.0:AustalWPS" port="AustalWPSPort"/>
						</invoke>
					</process>
				</deploy>
			</BPELSuitcase>
		</SuitCase>
		<BPEL>
			<!-- Austal BPEL Process -->
			<bpel:process name="Austal" targetNamespace="http://www.uncertweb.org" suppressJoinFailure="yes" xmlns:tns="http://www.uncertweb.org" xmlns:bpel="http://docs.oasis-open.org/wsbpel/2.0/process/executable" xmlns:wps="http://www.opengis.net/wps/1.0.0" xmlns:ows="http://www.opengis.net/ows/1.1" xmlns:om="http://www.opengis.net/om/1.0" xmlns:swe="http://www.opengis.net/swe/1.0" xmlns:gml="http://www.opengis.net/gml" xmlns:un="http://www.uncertml.org" xmlns:wfs="http://www.opengis.net/wfs" exitOnStandardFault="yes">
				<!-- Import the client WSDL -->
				<bpel:import namespace="http://www.opengis.net/wps/1.0.0" location="wps0.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"/>
				<bpel:import location="Austal.wsdl" namespace="http://www.uncertweb.org" importType="http://schemas.xmlsoap.org/wsdl/"/>
				<!-- ================================================================= -->
				<!-- PARTNERLINKS                                                      -->
				<!-- List of services participating in this BPEL process               -->
				<!-- ================================================================= -->
				<bpel:partnerLinks>
					<!-- The 'client' role represents the requester of this service. -->
					<bpel:partnerLink name="client" partnerLinkType="tns:Austal" myRole="AustalProvider"/>
					<bpel:partnerLink name="generalizewps" partnerLinkType="tns:WebProcessingService" partnerRole="WebProcessingServiceProvider"/>
					<bpel:partnerLink name="austalwps" partnerLinkType="tns:WebProcessingService" partnerRole="WebProcessingServiceProvider"/>
				</bpel:partnerLinks>
				<!-- ================================================================= -->
				<!-- VARIABLES                                                         -->
				<!-- List of messages and XML documents used within this BPEL process  -->
				<!-- ================================================================= -->
				<bpel:variables>
					<!-- Reference to the message passed as input during initiation -->
					<bpel:variable name="input" messageType="tns:AustalRequestMessage"/>
					<!-- Reference to the message that will be returned to the requester -->
					<bpel:variable name="output" messageType="tns:AustalResponseMessage"/>
					<!-- Reference to the messages used for intermediate service calls -->
					<bpel:variable name="elevationResponse" messageType="wps:OutputMessage"/>
					<bpel:variable name="elevationRequest" messageType="wps:InputMessage"/>
					<bpel:variable name="austalWPSResponse" messageType="wps:OutputMessage"/>
					<bpel:variable name="austalWPSRequest" messageType="wps:InputMessage"/>
				</bpel:variables>
				<!-- ================================================================= -->
				<!-- ORCHESTRATION LOGIC                                               -->
				<!-- Set of activities coordinating the flow of messages across the    -->
				<!-- services integrated within this business process                  -->
				<!-- ================================================================= -->
				<bpel:sequence name="main">
					<!-- Receive input from requester. Note: This maps to operation defined in Austal.wsdl -->
					<bpel:receive name="receiveInput" partnerLink="client" portType="tns:Austal" operation="process" variable="input" createInstance="yes"/>
					<!-- Generate reply to synchronous request -->
					<bpel:assign validate="no" name="assignElevationRequest">
						<bpel:copy>
							<bpel:from>
								<bpel:literal xml:space="preserve">
									<wps:Execute service="WPS" version="1.0.0" xmlns:ows="http://www.opengis.net/ows/1.1" xmlns:wps="http://www.opengis.net/wps/1.0.0" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.opengis.net/wps/1.0.0  http://geoserver.itc.nl:8080/wps/schemas/wps/1.0.0/wpsExecute_request.xsd">
										<ows:Identifier>org.n52.wps.server.algorithm.simplify.DouglasPeuckerAlgorithm</ows:Identifier>
										<wps:DataInputs>
											<wps:Input>
												<ows:Identifier>FEATURES</ows:Identifier>
												<wps:Reference xlink:href="http://localhost:8081/geoserver/ows?service=WFS&amp;version=1.0.0&amp;request=GetFeature&amp;typeName=cite2:schulweg" schema="http://schemas.opengis.net/gml/2.1.2/feature.xsd" encoding="UTF-8" mimeType="text/xml"/>
											</wps:Input>
											<wps:Input>
												<ows:Identifier>TOLERANCE</ows:Identifier>
												<wps:Data>
													<wps:LiteralData dataType="xs:double">0.5</wps:LiteralData>
												</wps:Data>
											</wps:Input>
										</wps:DataInputs>
										<wps:ResponseForm>
											<wps:ResponseDocument>
												<wps:Output schema="http://schemas.opengis.net/gml/2.1.2/feature.xsd">
													<ows:Identifier>SIMPLIFIED_FEATURES</ows:Identifier>
												</wps:Output>
											</wps:ResponseDocument>
										</wps:ResponseForm>
									</wps:Execute>
								</bpel:literal>
							</bpel:from>
							<bpel:to part="InPart" variable="elevationRequest"/>
						</bpel:copy>
					</bpel:assign>
					<bpel:invoke name="invokeElevation" partnerLink="generalizewps" operation="Execute" inputVariable="elevationRequest" outputVariable="elevationResponse"/>
					<bpel:assign validate="no" name="assignAustalWPSRequest">
						<bpel:copy>
							<bpel:from>
								<bpel:literal xml:space="preserve">
									<wps:Execute service="WPS" version="1.0.0" xmlns:ows="http://www.opengis.net/ows/1.1" xmlns:wps="http://www.opengis.net/wps/1.0.0" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.opengis.net/wps/1.0.0  http://geoserver.itc.nl:8080/wps/schemas/wps/1.0.0/wpsExecute_request.xsd">
										<ows:Identifier>org.n52.wps.server.algorithm.ComputeTimePeriod</ows:Identifier>
										<wps:DataInputs>
											<wps:Input>
												<ows:Identifier>FEATURES</ows:Identifier>
												<wps:Data>
													<wps:ComplexData/>
												</wps:Data>
											</wps:Input>
											<wps:Input>
												<ows:Identifier>START_TIME</ows:Identifier>
												<wps:Data>
													<wps:LiteralData dataType="xs:dateTime">2009-01-06T01:00:00+01:00</wps:LiteralData>
												</wps:Data>
											</wps:Input>
											<wps:Input>
												<ows:Identifier>END_TIME</ows:Identifier>
												<wps:Data>
													<wps:LiteralData dataType="xs:dateTime">2009-01-08T00:00:00+01:00</wps:LiteralData>
												</wps:Data>
											</wps:Input>
										</wps:DataInputs>
										<wps:ResponseForm>
											<wps:ResponseDocument>
												<wps:Output schema="http://schemas.opengis.net/gml/3.1.1/base/feature.xsd" mimeType="text/xml" encoding="UTF-8">
													<ows:Identifier>RESULT</ows:Identifier>
												</wps:Output>
											</wps:ResponseDocument>
										</wps:ResponseForm>
									</wps:Execute>
								</bpel:literal>
							</bpel:from>
							<bpel:to part="InPart" variable="austalWPSRequest"/>
						</bpel:copy>
						<bpel:copy>
							<bpel:from><![CDATA[$elevationResponse.OutPart//wps:ComplexData]]></bpel:from>
							<bpel:to><![CDATA[$austalWPSRequest.InPart//wps:ComplexData]]></bpel:to>
						</bpel:copy>
					</bpel:assign>
					<bpel:invoke name="invokeAustalWPSRequest" partnerLink="austalwps" operation="Execute" inputVariable="austalWPSRequest" outputVariable="austalWPSResponse"/>
					<bpel:assign validate="no" name="assignOutput">
						<bpel:copy>
							<bpel:from>
								<bpel:literal xml:space="preserve">
									<tns:AustalResponse xmlns:gml="http://www.opengis.net/gml" xmlns:om="http://www.opengis.net/om/1.0" xmlns:p="http://www.opengis.net/swe/1.0.1" xmlns:p1="urn:us:gov:ic:ism:v2" xmlns:smil20="http://www.w3.org/2001/SMIL20/" xmlns:smil20lang="http://www.w3.org/2001/SMIL20/Language" xmlns:sml="http://www.opengis.net/sensorML/1.0.1" xmlns:swe="http://www.opengis.net/swe/1.0" xmlns:tns="http://www.uncertweb.org" xmlns:un="http://www.uncertml.org" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xml="http://www.w3.org/XML/1998/namespace" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
										<gml:FeatureCollection/>
									</tns:AustalResponse>
								</bpel:literal>
							</bpel:from>
							<bpel:to variable="output" part="payload"/>
						</bpel:copy>
						<bpel:copy>
							<bpel:from><![CDATA[$austalWPSResponse.OutPart//gml:FeatureCollection]]></bpel:from>
							<bpel:to><![CDATA[$output.payload//gml:FeatureCollection]]></bpel:to>
						</bpel:copy>
					</bpel:assign>
					<bpel:reply name="replyOutput" partnerLink="client" portType="tns:Austal" operation="process" variable="output"/>
				</bpel:sequence>
			</bpel:process>
		</BPEL>
		<ProcessWSDL>
			<definitions xmlns="http://schemas.xmlsoap.org/wsdl/" xmlns:plnk="http://docs.oasis-open.org/wsbpel/2.0/plnktype" xmlns:tns="http://www.uncertweb.org" xmlns:vprop="http://docs.oasis-open.org/wsbpel/2.0/varprop" xmlns:wsdl="http://www.opengis.net/wps/1.0.0" name="Austal" targetNamespace="http://www.uncertweb.org" xmlns:soap="http://schemas.xmlsoap.org/wsdl/soap/" xmlns:om="http://www.opengis.net/om/1.0" xmlns:un="http://www.uncertml.org" xmlns:gml="http://www.opengis.net/gml" xmlns:wfs="http://www.opengis.net/wfs">
				<!--
		~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
		TYPE DEFINITION - List of types participating in this BPEL process The
		BPEL Designer will generate default request and response types but you
		can define or import any XML Schema type and use them as part of the
		message types.
		~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
	-->
				<plnk:partnerLinkType name="WebProcessingService">
					<plnk:role name="WebProcessingServiceProvider" portType="wsdl:ExecutePortType"/>
				</plnk:partnerLinkType>
				<import location="wps0.wsdl" namespace="http://www.opengis.net/wps/1.0.0"/>
				<types>
					<schema xmlns="http://www.w3.org/2001/XMLSchema" attributeFormDefault="unqualified" elementFormDefault="qualified" targetNamespace="http://www.uncertweb.org">
						<import namespace="http://www.opengis.net/om/1.0" schemaLocation="http://schemas.opengis.net/om/1.0.0/om.xsd"/>
						<element name="AustalRequest">
							<complexType>
								<sequence>
									<element ref="om:Observation"/>
								</sequence>
							</complexType>
						</element>
						<element name="AustalResponse">
							<complexType>
								<sequence>
									<element ref="gml:FeatureCollection"/>
								</sequence>
							</complexType>
						</element>
					</schema>
				</types>
				<!--
		~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
		MESSAGE TYPE DEFINITION - Definition of the message types used as part
		of the port type defintions
		~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
	-->
				<message name="AustalRequestMessage">
					<part element="tns:AustalRequest" name="payload"/>
				</message>
				<message name="AustalResponseMessage">
					<part element="tns:AustalResponse" name="payload"/>
				</message>
				<!--
		~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
		PORT TYPE DEFINITION - A port type groups a set of operations into a
		logical service unit.
		~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
	-->
				<!--
		portType implemented by the Austal BPEL process
	-->
				<portType name="Austal">
					<operation name="process">
						<input message="tns:AustalRequestMessage"/>
						<output message="tns:AustalResponseMessage"/>
					</operation>
				</portType>
				<!--
		~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
		PARTNER LINK TYPE DEFINITION
		~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
	-->
				<plnk:partnerLinkType name="Austal">
					<plnk:role name="AustalProvider" portType="tns:Austal"/>
				</plnk:partnerLinkType>
				<binding name="SOAPBinding" type="tns:Austal">
					<soap:binding style="document" transport="http://schemas.xmlsoap.org/soap/http"/>
					<operation name="process">
						<soap:operation soapAction="http://www.uncertweb.org/process"/>
						<input>
							<soap:body use="literal"/>
						</input>
						<output>
							<soap:body use="literal"/>
						</output>
					</operation>
				</binding>
				<service name="Austal">
					<port name="AustalPort" binding="tns:SOAPBinding">
						<soap:address location="http://localhost:8181/ode/processes/Austal"/>
					</port>
				</service>
			</definitions>
		</ProcessWSDL>
		<WSDL-List>
			<definitions targetNamespace="http://www.opengis.net/wps/1.0.0" xmlns:tns="http://www.opengis.net/wps/1.0.0" xmlns="http://schemas.xmlsoap.org/wsdl/" xmlns:http="http://schemas.xmlsoap.org/wsdl/http/" xmlns:mime="http://schemas.xmlsoap.org/wsdl/mime/" xmlns:wps="http://www.opengis.net/wps/1.0.0" xmlns:soap="http://schemas.xmlsoap.org/wsdl/soap/">
				<types xmlns:xsd="http://www.w3.org/2001/XMLSchema">
					<xsd:schema targetNamespace="http://whateverNS">
						<xsd:import namespace="http://www.opengis.net/wps/1.0.0" schemaLocation="http://schemas.opengis.net/wps/1.0.0/wpsAll.xsd"/>
					</xsd:schema>
				</types>
				<message name="InputMessage">
					<part element="wps:Execute" name="InPart"/>
				</message>
				<message name="OutputMessage">
					<part element="wps:ExecuteResponse" name="OutPart"/>
				</message>
				<portType name="ExecutePortType">
					<operation name="Execute">
						<input message="tns:InputMessage"/>
						<output message="tns:OutputMessage"/>
					</operation>
				</portType>
				<binding name="HTTPPOSTBinding" type="tns:ExecutePortType">
					<http:binding verb="POST"/>
					<operation name="Execute">
						<http:operation location=""/>
						<input>
							<mime:content part="InPart" type="text/xml"/>
						</input>
						<output>
							<mime:content part="OutPart" type="text/xml"/>
						</output>
					</operation>
				</binding>
				<service name="AustalWPS">
					<port binding="tns:HTTPPOSTBinding" name="AustalWPSPort">
						<http:address location="http://localhost:8080/wps2/WebProcessingService"/>
					</port>
				</service>
				<service name="GeneralizeWPS">
					<port name="GeneralizeWPSPort" binding="tns:HTTPPOSTBinding">
						<http:address location="http://localhost:8080/wps/WebProcessingService"/>
					</port>
				</service>
			</definitions>
		</WSDL-List>
	</wps:DeploymentProfile>
</DeployProcessRequest>
